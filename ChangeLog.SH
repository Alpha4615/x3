#!/bin/sh
# Convert git log to GNU-style ChangeLog file.
# (C) Chris
TARGET=$(dirname $0)/ChangeLog
CLASSIC=$(dirname $0)/ChangeLog.classic
MSG="X3 ChangeLog (Generated by ChangeLog.SH from GIT commit logs)\nThis file is auto-generated from ChangeLog.SH\n\n"
if test -d ".git"; then
    #Put new stuff at the top, starting at 1.8.1 the revision we started
    #using git and stopped using ChangeLog manually
    echo "$MSG" > "$TARGET"
    git log --format="%ai %aN %n%n%x09* %s%d%n" 1.8.1..HEAD >> "$TARGET"
    #Then put historical stuff in as it was
    cat "$CLASSIC" >> "$TARGET"
    exit 0
else
    echo "No git repository present."
    exit 1
fi
